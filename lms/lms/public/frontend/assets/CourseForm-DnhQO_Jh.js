var Q=Object.defineProperty;var E=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var $=(p,u,i)=>u in p?Q(p,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[u]=i,k=(p,u)=>{for(var i in u||(u={}))W.call(u,i)&&$(p,i,u[i]);if(E)for(var i of E(u))Y.call(u,i)&&$(p,i,u[i]);return p};import{d as Z,r as P,aa as ee,a as se,s as le,az as oe,k as y,w as ae,j as T,x as g,y as v,C as a,H as r,I as t,B as C,J as m,A as F,K as te,L as re,M as x,aR as ie,av as ne,N as j,R as d,aJ as ue,a9 as L,aN as de}from"./frappe-ui-CfOnYHud.js";import{a1 as D,k as V,u as me,j as ce,D as pe,H as _e,X as M}from"./index-5_0ocoxz.js";import{_ as be}from"./CourseOutline-CUa4yH_C.js";import{_ as fe}from"./MultiSelect-B-q7M6eT.js";const ge={class:""},ve={class:"grid md:grid-cols-[70%,30%] h-full"},ye={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},Ve={class:"flex items-center mt-3 md:mt-0"},he={class:"mt-5 mb-10"},ke={class:"container mb-5"},Ce={class:"text-lg font-semibold mb-4"},xe={class:"mb-4"},we={class:"mb-1.5 text-sm text-gray-700"},Ne={class:"mb-4"},Ue={key:1,class:"mb-4"},Se={class:"text-xs text-gray-600 mb-1"},Ee={class:"flex items-center"},$e={class:"border rounded-md p-2 mr-2"},Pe={class:"flex flex-col"},Te={class:"text-sm text-gray-500 mt-1"},Fe={class:"mb-4"},je={class:"mb-1.5 text-xs text-gray-600"},Le={class:"flex items-center"},De={class:"flex items-center bg-gray-100 p-2 rounded-md mr-2"},Me={class:"container border-t"},Re={class:"text-lg font-semibold mt-5 mb-4"},Be={class:"grid grid-cols-3 gap-10 mb-4"},Ie={key:0,class:"flex flex-col space-y-3"},Ke={class:"flex flex-col space-y-3"},Oe={class:"flex flex-col space-y-3"},ze={class:"container border-t"},He={class:"text-lg font-semibold mt-5 mb-4"},Je={class:"mb-4"},Ae={class:"border-l pt-5"},Ye={__name:"CourseForm",props:{courseName:{type:String}},setup(p){const u=Z("$user"),i=P(""),h=ee(),_=P([]),b=p,l=se({title:"",short_introduction:"",description:"",video_link:"",course_image:null,tags:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,course_price:"",currency:""});le(()=>{var e,s;b.courseName=="new"&&!((e=u.data)!=null&&e.is_moderator)&&!((s=u.data)!=null&&s.is_instructor)&&h.push({name:"Courses"}),b.courseName!=="new"?f.reload():D("course_form_opened"),window.addEventListener("keydown",w)});const w=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(N(),e.preventDefault())};oe(()=>{window.removeEventListener("keydown",w)});const R=y({url:"frappe.client.insert",makeParams(e){var s;return{doc:k({doctype:"LMS Course",image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:_.value.map(n=>({instructor:n}))},e)}}}),B=y({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Course",name:e.course,fieldname:k({image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:_.value.map(n=>({instructor:n}))},l)}}}),f=y({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:b.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(n=>{n=="instructors"?(_.value=[],e.instructors.forEach(c=>{_.value.push(c.instructor)})):Object.hasOwn(l,n)&&(l[n]=e[n])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification"];for(let n in s){let c=s[n];l[c]=!!l[c]}e.image&&I.reload({image:e.image}),A()}}),I=y({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.course_image=e}}),N=()=>{f.data?B.submit({course:f.data.name},{onSuccess(){V("Success","Course updated successfully","check")},onError(e){var s;V("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}}):R.submit(l,{onSuccess(e){D("course_created"),V("Success","Course created successfully","check"),h.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){var s;V("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}})};ae(()=>b.courseName!=="new",e=>{e&&f.reload()});const K=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return"Only image file is allowed."},O=()=>{i.value&&(l.tags=l.tags?`${l.tags}, ${i.value}`:i.value,i.value="")},z=e=>{var s;l.tags=(s=l.tags)==null?void 0:s.split(", ").filter(n=>n!==e).join(", "),i.value=""},H=e=>{l.course_image=e},J=()=>{l.course_image=null},A=()=>{var s;let e=!1;(s=u.data)!=null&&s.is_moderator||(_.value.forEach(n=>{var c;!e&&n==((c=u.data)==null?void 0:c.name)&&(e=!0)}),e||h.push({name:"Courses"}))},X=T(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return f.data&&e.push({label:l.title,route:{name:"CourseDetail",params:{courseName:b.courseName}}}),e.push({label:b.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:b.courseName}}}),e}),q=T(()=>({title:"Create a Course",description:"Create or edit a course for your learning system."}));return me(q),(e,s)=>{var n,c;return g(),v("div",ge,[a("div",ve,[a("div",null,[a("header",ye,[r(t(ne),{class:"h-7",items:X.value},null,8,["items"]),a("div",Ve,[r(t(j),{variant:"solid",onClick:s[0]||(s[0]=o=>N()),class:"ml-2"},{default:C(()=>[a("span",null,m(e.__("Save")),1)]),_:1})])]),a("div",he,[a("div",ke,[a("div",Ce,m(e.__("Details")),1),r(t(d),{modelValue:l.title,"onUpdate:modelValue":s[1]||(s[1]=o=>l.title=o),label:e.__("Title"),class:"mb-4"},null,8,["modelValue","label"]),r(t(d),{modelValue:l.short_introduction,"onUpdate:modelValue":s[2]||(s[2]=o=>l.short_introduction=o),label:e.__("Short Introduction"),class:"mb-4"},null,8,["modelValue","label"]),a("div",xe,[a("div",we,m(e.__("Course Description")),1),r(t(ue),{content:l.description,onChange:s[3]||(s[3]=o=>l.description=o),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-gray-100 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),l.course_image?(g(),v("div",Ue,[a("div",Se,m(e.__("Course Image")),1),a("div",Ee,[a("div",$e,[r(t(pe),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),a("div",Pe,[a("span",null,m(l.course_image.file_name),1),a("span",Te,m(t(_e)(l.course_image.file_size)),1)]),r(t(M),{onClick:s[5]||(s[5]=o=>J()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(g(),F(t(de),{key:0,fileTypes:["image/*"],validateFile:K,onSuccess:s[4]||(s[4]=o=>H(o))},{default:C(({file:o,progress:U,uploading:S,openFileSelector:G})=>[a("div",Ne,[r(t(j),{onClick:G,loading:S},{default:C(()=>[L(m(S?`Uploading ${U}%`:"Upload an image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),r(t(d),{modelValue:l.video_link,"onUpdate:modelValue":s[6]||(s[6]=o=>l.video_link=o),label:e.__("Preview Video"),class:"mb-4"},null,8,["modelValue","label"]),a("div",Fe,[a("div",je,m(e.__("Tags")),1),a("div",Le,[l.tags?(g(!0),v(te,{key:0},re((n=l.tags)==null?void 0:n.split(", "),o=>(g(),v("div",De,[L(m(o)+" ",1),r(t(M),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:U=>z(o)},null,8,["onClick"])]))),256)):x("",!0),r(t(d),{modelValue:i.value,"onUpdate:modelValue":s[7]||(s[7]=o=>i.value=o),onKeyup:s[8]||(s[8]=ie(o=>O(),["enter"])),id:"tags"},null,8,["modelValue"])])]),r(fe,{modelValue:_.value,"onUpdate:modelValue":s[9]||(s[9]=o=>_.value=o),doctype:"User",label:e.__("Instructors")},null,8,["modelValue","label"])]),a("div",Me,[a("div",Re,m(e.__("Settings")),1),a("div",Be,[(c=t(u).data)!=null&&c.is_moderator?(g(),v("div",Ie,[r(t(d),{type:"checkbox",modelValue:l.published,"onUpdate:modelValue":s[10]||(s[10]=o=>l.published=o),label:e.__("Published")},null,8,["modelValue","label"]),r(t(d),{modelValue:l.published_on,"onUpdate:modelValue":s[11]||(s[11]=o=>l.published_on=o),label:e.__("Published On"),type:"date",class:"mb-5"},null,8,["modelValue","label"])])):x("",!0),a("div",Ke,[r(t(d),{type:"checkbox",modelValue:l.upcoming,"onUpdate:modelValue":s[12]||(s[12]=o=>l.upcoming=o),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.featured,"onUpdate:modelValue":s[13]||(s[13]=o=>l.featured=o),label:e.__("Featured")},null,8,["modelValue","label"])]),a("div",Oe,[r(t(d),{type:"checkbox",modelValue:l.disable_self_learning,"onUpdate:modelValue":s[14]||(s[14]=o=>l.disable_self_learning=o),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.enable_certification,"onUpdate:modelValue":s[15]||(s[15]=o=>l.enable_certification=o),label:e.__("Completion Certificate")},null,8,["modelValue","label"])])])]),a("div",ze,[a("div",He,m(e.__("Pricing")),1),a("div",Je,[r(t(d),{type:"checkbox",modelValue:l.paid_course,"onUpdate:modelValue":s[16]||(s[16]=o=>l.paid_course=o),label:e.__("Paid Course")},null,8,["modelValue","label"])]),r(t(d),{modelValue:l.course_price,"onUpdate:modelValue":s[17]||(s[17]=o=>l.course_price=o),label:e.__("Course Price"),class:"mb-4"},null,8,["modelValue","label"]),r(ce,{doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":s[18]||(s[18]=o=>l.currency=o),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])])]),a("div",Ae,[t(f).data?(g(),F(be,{key:0,courseName:t(f).data.name,title:l.title,allowEdit:!0},null,8,["courseName","title"])):x("",!0)])])])}}};export{Ye as default};
//# sourceMappingURL=CourseForm-DnhQO_Jh.js.map
