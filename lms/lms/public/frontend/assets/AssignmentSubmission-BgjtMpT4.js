import{d as $,r as h,aa as j,k as f,s as B,j as H,x as r,y as u,C as n,H as c,I as a,B as b,J as i,M as w,A as I,K as O,av as q,a9 as S,N as x,aN as z,R as J,aJ as K}from"./frappe-ui-CfOnYHud.js";import{k as g,D as Q,H as W,X}from"./index-5_0ocoxz.js";const Y={class:"flex justify-between sticky top-0 z-10 border-b bg-white px-3 py-2.5 sm:px-5"},G={class:"container py-5"},Z={key:0,class:"bg-blue-100 p-2 rounded-md leading-5 text-sm italic"},ee={key:1},se={class:"text-xl font-semibold hidden"},te={class:"text-sm mt-1 hidden"},ne=["innerHTML"],ae={class:""},ie={class:"text-xl font-semibold mt-10"},oe={key:0},le={class:"text-sm mt-1 mb-4"},re={key:1},me={class:"flex items-center"},de={class:"border rounded-md p-2 mr-2"},ue={class:"flex flex-col"},ce={class:"text-sm text-gray-500 mt-1"},pe={key:1},fe={class:"text-sm mb-4"},_e={key:2},ge={class:"text-sm mb-4"},ke={__name:"AssignmentSubmission",props:{assignmentName:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(k){const v=$("$user"),l=h(null),m=h(null),N=j(),d=k,o=f({url:"frappe.client.get",params:{doctype:"LMS Assignment",name:d.assignmentName},auto:!0}),_=()=>{var e;return["PDF","Image","Document"].includes((e=o.data)==null?void 0:e.type)},F=f({url:"frappe.client.set_value",makeParams(e){let s={};return _()?s.assignment_attachment=l.value.file_url:s.answer=m.value,{doctype:"LMS Assignment Submission",name:d.submissionName,fieldname:s}}}),A=f({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.value=e}}),C=f({url:"frappe.client.insert",makeParams(e){var t;let s={doctype:"LMS Assignment Submission",assignment:d.assignmentName,member:(t=v.data)==null?void 0:t.name};return _()?s.assignment_attachment=l.value.file_url:s.answer=m.value,{doc:s}}}),y=f({url:"frappe.client.get_value",params:{doctype:"LMS Assignment Submission",fieldname:_()?"assignment_attachment":"answer",filters:{name:d.submissionName}},onSuccess(e){e.assignment_attachment&&A.reload({image:e.assignment_attachment}),e.answer&&(m.value=e.answer)}});B(()=>{v.data||(window.location.href="/login"),d.submissionName!="new"&&y.reload()});const M=()=>{d.submissionName!="new"?F.submit({},{onSuccess(e){g("Success","Submission updated successfully.","check")},onError(e){var s;g("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}}):D()},D=()=>{C.submit({},{onSuccess(e){g("Success","Assignment submitted successfully.","check"),N.push({name:"AssignmentSubmission",params:{assignmentName:d.assignmentName,submissionName:e.name}})},onError(e){var s;g("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}})},L=H(()=>{var s,t;return[{label:"Assignment"},{label:(s=o.data)==null?void 0:s.title,route:{name:"AssignmentSubmission",params:{assignmentName:(t=o.data)==null?void 0:t.name}}}]}),T=e=>{l.value=e},P=()=>{var s;const e=(s=o.data)==null?void 0:s.type;if(e=="Image")return["image/*"];if(e=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e=="PDF")return[".pdf"]},R=e=>{var p;let s=(p=o.data)==null?void 0:p.type,t=e.name.split(".").pop().toLowerCase();if(s=="Image"&&!["jpg","jpeg","png"].includes(t))return"Only image file is allowed.";if(s=="Document"&&!["doc","docx","xml"].includes(t))return"Only document file is allowed.";if(s=="PDF"&&!["pdf"].includes(t))return"Only PDF file is allowed."},E=()=>{l.value=null};return(e,s)=>(r(),u(O,null,[n("header",Y,[c(a(q),{items:L.value},null,8,["items"]),c(a(x),{variant:"solid",onClick:s[0]||(s[0]=t=>M())},{default:b(()=>[S(i(e.__("Save")),1)]),_:1})]),n("div",G,[a(y).data?(r(),u("div",Z,i(e.__("You've successfully submitted the assignment."))+" "+i(e.__("Once the moderator grades your submission, you'll find the details here."))+" "+i(e.__("Feel free to make edits to your submission if needed.")),1)):w("",!0),a(o).data?(r(),u("div",ee,[n("div",null,[n("div",se,i(e.__("Question")),1),n("div",te,i(e.__("Read the question carefully before attempting the assignment.")),1),n("div",{innerHTML:a(o).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-gray-300 prose-th:border-gray-300 prose-td:relative prose-th:relative prose-th:bg-gray-100 prose-sm max-w-none !whitespace-normal"},null,8,ne)]),n("div",ae,[n("div",ie,i(e.__("Submission")),1),_()?(r(),u("div",oe,[n("div",le,i(e.__("Add your assignment as {0}").format(a(o).data.type)),1),l.value?(r(),u("div",re,[n("div",me,[n("div",de,[c(a(Q),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),n("div",ue,[n("span",null,i(l.value.file_name),1),n("span",ce,i(a(W)(l.value.file_size)),1)]),c(a(X),{onClick:s[2]||(s[2]=t=>E()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(r(),I(a(z),{key:0,fileTypes:P(),validateFile:R,onSuccess:s[1]||(s[1]=t=>T(t))},{default:b(({file:t,uploading:p,progress:U,uploaded:be,message:ve,error:ye,total:he,success:we,openFileSelector:V})=>[c(a(x),{onClick:V,loading:p},{default:b(()=>[S(i(p?e.__("Uploading {0}%").format(U):e.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(o).data.type=="URL"?(r(),u("div",pe,[n("div",fe,i(e.__("Enter a URL")),1),c(a(J),{modelValue:m.value,"onUpdate:modelValue":s[3]||(s[3]=t=>m.value=t)},null,8,["modelValue"])])):(r(),u("div",_e,[n("div",ge,i(e.__("Write your answer here")),1),c(a(K),{content:m.value,onChange:s[4]||(s[4]=t=>m.value=t),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-gray-100 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]))])])):w("",!0)])],64))}};export{ke as default};
//# sourceMappingURL=AssignmentSubmission-BgjtMpT4.js.map
