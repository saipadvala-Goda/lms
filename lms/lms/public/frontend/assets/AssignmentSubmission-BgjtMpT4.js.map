{"version":3,"file":"AssignmentSubmission-BgjtMpT4.js","sources":["../../../../frontend/src/pages/AssignmentSubmission.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"flex justify-between sticky top-0 z-10 border-b bg-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<Button variant=\"solid\" @click=\"submitAssignment()\">\n\t\t\t{{ __('Save') }}\n\t\t</Button>\n\t</header>\n\t<div class=\"container py-5\">\n\t\t<div\n\t\t\tv-if=\"submissionResource.data\"\n\t\t\tclass=\"bg-blue-100 p-2 rounded-md leading-5 text-sm italic\"\n\t\t>\n\t\t\t{{ __(\"You've successfully submitted the assignment.\") }}\n\t\t\t{{\n\t\t\t\t__(\n\t\t\t\t\t\"Once the moderator grades your submission, you'll find the details here.\"\n\t\t\t\t)\n\t\t\t}}\n\t\t\t{{ __('Feel free to make edits to your submission if needed.') }}\n\t\t</div>\n\t\t<div v-if=\"assignment.data\">\n\t\t\t<div>\n\t\t\t\t<div class=\"text-xl font-semibold hidden\">\n\t\t\t\t\t{{ __('Question') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"text-sm mt-1 hidden\">\n\t\t\t\t\t{{\n\t\t\t\t\t\t__('Read the question carefully before attempting the assignment.')\n\t\t\t\t\t}}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-html=\"assignment.data.question\"\n\t\t\t\t\tclass=\"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-gray-300 prose-th:border-gray-300 prose-td:relative prose-th:relative prose-th:bg-gray-100 prose-sm max-w-none !whitespace-normal\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"\">\n\t\t\t\t<div class=\"text-xl font-semibold mt-10\">\n\t\t\t\t\t{{ __('Submission') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showUploader()\">\n\t\t\t\t\t<div class=\"text-sm mt-1 mb-4\">\n\t\t\t\t\t\t{{ __('Add your assignment as {0}').format(assignment.data.type) }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<FileUploader\n\t\t\t\t\t\tv-if=\"!submissionFile\"\n\t\t\t\t\t\t:fileTypes=\"getType()\"\n\t\t\t\t\t\t:validateFile=\"validateFile\"\n\t\t\t\t\t\t@success=\"(file) => saveSubmission(file)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\t#default=\"{\n\t\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t\tuploading,\n\t\t\t\t\t\t\t\tprogress,\n\t\t\t\t\t\t\t\tuploaded,\n\t\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\ttotal,\n\t\t\t\t\t\t\t\tsuccess,\n\t\t\t\t\t\t\t\topenFileSelector,\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button @click=\"openFileSelector\" :loading=\"uploading\">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tuploading\n\t\t\t\t\t\t\t\t\t\t? __('Uploading {0}%').format(progress)\n\t\t\t\t\t\t\t\t\t\t: __('Upload File')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</FileUploader>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<div class=\"border rounded-md p-2 mr-2\">\n\t\t\t\t\t\t\t\t<FileText class=\"h-5 w-5 stroke-1.5 text-gray-700\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t{{ submissionFile.file_name }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-500 mt-1\">\n\t\t\t\t\t\t\t\t\t{{ getFileSize(submissionFile.file_size) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<X\n\t\t\t\t\t\t\t\t@click=\"removeSubmission()\"\n\t\t\t\t\t\t\t\tclass=\"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"assignment.data.type == 'URL'\">\n\t\t\t\t\t<div class=\"text-sm mb-4\">\n\t\t\t\t\t\t{{ __('Enter a URL') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<FormControl v-model=\"answer\" />\n\t\t\t\t</div>\n\t\t\t\t<div v-else>\n\t\t\t\t\t<div class=\"text-sm mb-4\">\n\t\t\t\t\t\t{{ __('Write your answer here') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<TextEditor\n\t\t\t\t\t\t:content=\"answer\"\n\t\t\t\t\t\t@change=\"(val) => (answer = val)\"\n\t\t\t\t\t\t:editable=\"true\"\n\t\t\t\t\t\t:fixedMenu=\"true\"\n\t\t\t\t\t\teditorClass=\"prose-sm max-w-none border-b border-x bg-gray-100 rounded-b-md py-1 px-2 min-h-[7rem]\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tcreateResource,\n\tFileUploader,\n\tButton,\n\tFormControl,\n\tTextEditor,\n} from 'frappe-ui'\nimport { FileText, X } from 'lucide-vue-next'\nimport { computed, inject, onMounted, ref } from 'vue'\nimport { showToast, getFileSize } from '../utils'\nimport { useRouter } from 'vue-router'\n\nconst user = inject('$user')\nconst submissionFile = ref(null)\nconst answer = ref(null)\nconst router = useRouter()\n\nconst props = defineProps({\n\tassignmentName: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tsubmissionName: {\n\t\ttype: String,\n\t\tdefault: 'new',\n\t},\n})\n\nconst assignment = createResource({\n\turl: 'frappe.client.get',\n\tparams: {\n\t\tdoctype: 'LMS Assignment',\n\t\tname: props.assignmentName,\n\t},\n\tauto: true,\n})\n\nconst showUploader = () => {\n\treturn ['PDF', 'Image', 'Document'].includes(assignment.data?.type)\n}\n\nconst updateSubmission = createResource({\n\turl: 'frappe.client.set_value',\n\tmakeParams(values) {\n\t\tlet fieldname = {}\n\t\tif (showUploader()) {\n\t\t\tfieldname.assignment_attachment = submissionFile.value.file_url\n\t\t} else {\n\t\t\tfieldname.answer = answer.value\n\t\t}\n\t\treturn {\n\t\t\tdoctype: 'LMS Assignment Submission',\n\t\t\tname: props.submissionName,\n\t\t\tfieldname: fieldname,\n\t\t}\n\t},\n})\n\nconst imageResource = createResource({\n\turl: 'lms.lms.api.get_file_info',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tfile_url: values.image,\n\t\t}\n\t},\n\tauto: false,\n\tonSuccess(data) {\n\t\tsubmissionFile.value = data\n\t},\n})\n\nconst newSubmission = createResource({\n\turl: 'frappe.client.insert',\n\tmakeParams(values) {\n\t\tlet doc = {\n\t\t\tdoctype: 'LMS Assignment Submission',\n\t\t\tassignment: props.assignmentName,\n\t\t\tmember: user.data?.name,\n\t\t}\n\t\tif (showUploader()) {\n\t\t\tdoc.assignment_attachment = submissionFile.value.file_url\n\t\t} else {\n\t\t\tdoc.answer = answer.value\n\t\t}\n\t\treturn {\n\t\t\tdoc: doc,\n\t\t}\n\t},\n})\n\nconst submissionResource = createResource({\n\turl: 'frappe.client.get_value',\n\tparams: {\n\t\tdoctype: 'LMS Assignment Submission',\n\t\tfieldname: showUploader() ? 'assignment_attachment' : 'answer',\n\t\tfilters: {\n\t\t\tname: props.submissionName,\n\t\t},\n\t},\n\tonSuccess(data) {\n\t\tif (data.assignment_attachment)\n\t\t\timageResource.reload({ image: data.assignment_attachment })\n\t\tif (data.answer) answer.value = data.answer\n\t},\n})\nonMounted(() => {\n\tif (!user.data) {\n\t\twindow.location.href = '/login'\n\t}\n\tif (props.submissionName != 'new') {\n\t\tsubmissionResource.reload()\n\t}\n})\n\nconst submitAssignment = () => {\n\tif (props.submissionName != 'new') {\n\t\tupdateSubmission.submit(\n\t\t\t{},\n\t\t\t{\n\t\t\t\tonSuccess(data) {\n\t\t\t\t\tshowToast('Success', 'Submission updated successfully.', 'check')\n\t\t\t\t},\n\t\t\t\tonError(err) {\n\t\t\t\t\tshowToast('Error', err.messages?.[0] || err, 'x')\n\t\t\t\t},\n\t\t\t}\n\t\t)\n\t} else {\n\t\taddNewSubmission()\n\t}\n}\n\nconst addNewSubmission = () => {\n\tnewSubmission.submit(\n\t\t{},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\tshowToast('Success', 'Assignment submitted successfully.', 'check')\n\t\t\t\trouter.push({\n\t\t\t\t\tname: 'AssignmentSubmission',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tassignmentName: props.assignmentName,\n\t\t\t\t\t\tsubmissionName: data.name,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\tshowToast('Error', err.messages?.[0] || err, 'x')\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst breadcrumbs = computed(() => {\n\tlet crumbs = [\n\t\t{\n\t\t\tlabel: 'Assignment',\n\t\t},\n\t\t{\n\t\t\tlabel: assignment.data?.title,\n\t\t\troute: {\n\t\t\t\tname: 'AssignmentSubmission',\n\t\t\t\tparams: {\n\t\t\t\t\tassignmentName: assignment.data?.name,\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t]\n\treturn crumbs\n})\n\nconst saveSubmission = (file) => {\n\tsubmissionFile.value = file\n}\n\nconst getType = () => {\n\tconst type = assignment.data?.type\n\tif (type == 'Image') {\n\t\treturn ['image/*']\n\t} else if (type == 'Document') {\n\t\treturn [\n\t\t\t'.doc',\n\t\t\t'.docx',\n\t\t\t'.xml',\n\t\t\t'application/msword',\n\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n\t\t]\n\t} else if (type == 'PDF') {\n\t\treturn ['.pdf']\n\t}\n}\n\nconst validateFile = (file) => {\n\tlet type = assignment.data?.type\n\tlet extension = file.name.split('.').pop().toLowerCase()\n\tif (type == 'Image' && !['jpg', 'jpeg', 'png'].includes(extension)) {\n\t\treturn 'Only image file is allowed.'\n\t} else if (\n\t\ttype == 'Document' &&\n\t\t!['doc', 'docx', 'xml'].includes(extension)\n\t) {\n\t\treturn 'Only document file is allowed.'\n\t} else if (type == 'PDF' && !['pdf'].includes(extension)) {\n\t\treturn 'Only PDF file is allowed.'\n\t}\n}\n\nconst removeSubmission = () => {\n\tsubmissionFile.value = null\n}\n</script>\n"],"names":["user","inject","submissionFile","ref","answer","router","useRouter","props","__props","assignment","createResource","showUploader","_a","updateSubmission","values","fieldname","imageResource","data","newSubmission","doc","submissionResource","onMounted","submitAssignment","showToast","err","addNewSubmission","breadcrumbs","computed","_b","saveSubmission","file","getType","type","validateFile","extension","removeSubmission"],"mappings":"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"}