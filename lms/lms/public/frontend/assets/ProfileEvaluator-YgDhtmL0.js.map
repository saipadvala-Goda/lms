{"version":3,"file":"ProfileEvaluator-YgDhtmL0.js","sources":["../../../../frontend/src/pages/ProfileEvaluator.vue"],"sourcesContent":["<template>\n\t<div class=\"mt-7 mb-20\">\n\t\t<h2 class=\"mb-4 text-lg font-semibold text-gray-900\">\n\t\t\t{{ __('My availability') }}\n\t\t</h2>\n\n\t\t<div class=\"\">\n\t\t\t<div\n\t\t\t\tclass=\"grid grid-cols-3 md:grid-cols-4 gap-4 text-sm text-gray-700 mb-4\"\n\t\t\t>\n\t\t\t\t<div>\n\t\t\t\t\t{{ __('Day') }}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t{{ __('Start Time') }}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t{{ __('End Time') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tv-if=\"evaluator.data\"\n\t\t\t\tv-for=\"slot in evaluator.data.slots.schedule\"\n\t\t\t\tclass=\"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4 group\"\n\t\t\t>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t:options=\"days\"\n\t\t\t\t\tv-model=\"slot.day\"\n\t\t\t\t\t@focusout.stop=\"update(slot.name, 'day', slot.day)\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"time\"\n\t\t\t\t\tv-model=\"slot.start_time\"\n\t\t\t\t\t@focusout.stop=\"update(slot.name, 'start_time', slot.start_time)\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"time\"\n\t\t\t\t\tv-model=\"slot.end_time\"\n\t\t\t\t\t@focusout.stop=\"update(slot.name, 'end_time', slot.end_time)\"\n\t\t\t\t/>\n\t\t\t\t<X\n\t\t\t\t\t@click=\"deleteRow(slot.name)\"\n\t\t\t\t\tclass=\"w-6 h-auto stroke-1.5 text-red-900 rounded-md cursor-pointer p-1 bg-red-100 hidden group-hover:block\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4\"\n\t\t\t\tv-show=\"showSlotsTemplate\"\n\t\t\t>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t:options=\"days\"\n\t\t\t\t\tv-model=\"newSlot.day\"\n\t\t\t\t\t@focusout.stop=\"add()\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"time\"\n\t\t\t\t\tv-model=\"newSlot.start_time\"\n\t\t\t\t\t@focusout.stop=\"add()\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"time\"\n\t\t\t\t\tv-model=\"newSlot.end_time\"\n\t\t\t\t\t@focusout.stop=\"add()\"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<Button @click=\"showSlotsTemplate = 1\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<Plus class=\"w-4 h-4 stroke-1.5 text-gray-700\" />\n\t\t\t\t</template>\n\t\t\t\t{{ __('Add Slot') }}\n\t\t\t</Button>\n\t\t</div>\n\t\t<div class=\"my-10\">\n\t\t\t<h2 class=\"mb-4 text-lg font-semibold text-gray-900\">\n\t\t\t\t{{ __('I am unavailable') }}\n\t\t\t</h2>\n\t\t\t<div class=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t:label=\"__('From')\"\n\t\t\t\t\tv-model=\"from\"\n\t\t\t\t\t@blur=\"\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tupdateUnavailability.submit({\n\t\t\t\t\t\t\t\tfield: 'unavailable_from',\n\t\t\t\t\t\t\t\tvalue: from,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t:label=\"__('To')\"\n\t\t\t\t\tv-model=\"to\"\n\t\t\t\t\t@blur=\"\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tupdateUnavailability.submit({\n\t\t\t\t\t\t\t\tfield: 'unavailable_to',\n\t\t\t\t\t\t\t\tvalue: to,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div>\n\t\t\t<h2 class=\"mb-4 text-lg font-semibold text-gray-900\">\n\t\t\t\t{{ __('My calendar') }}\n\t\t\t</h2>\n\t\t\t<div\n\t\t\t\tv-if=\"evaluator.data?.calendar && evaluator.data?.is_authorized\"\n\t\t\t\tclass=\"flex items-center bg-green-100 text-green-900 text-sm p-1 rounded-md mb-4 w-fit\"\n\t\t\t>\n\t\t\t\t<Check class=\"h-4 w-4 stroke-1.5 mr-2\" />\n\t\t\t\t{{ __('Your calendar is set.') }}\n\t\t\t</div>\n\t\t\t<Button @click=\"() => authorizeCalendar.submit()\">\n\t\t\t\t{{ __('Authorize Google Calendar Access') }}\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport { createResource, FormControl, Button } from 'frappe-ui'\nimport { computed, reactive, ref, onMounted, inject } from 'vue'\nimport { showToast, convertToTitleCase } from '@/utils'\nimport { Plus, X, Check } from 'lucide-vue-next'\n\nconst user = inject('$user')\n\nconst props = defineProps({\n\tprofile: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n})\n\nonMounted(() => {\n\tif (user.data?.name !== props.profile.data?.name) {\n\t\twindow.location.href = `/user/${props.profile.data?.username}`\n\t}\n})\n\nconst showSlotsTemplate = ref(0)\nconst from = ref(null)\nconst to = ref(null)\n\nconst newSlot = reactive({\n\tday: '',\n\tstart_time: '',\n\tend_time: '',\n})\n\nconst evaluator = createResource({\n\turl: 'lms.lms.api.get_evaluator_details',\n\tparams: {\n\t\tevaluator: props.profile.data?.name,\n\t},\n\tauto: true,\n\tonSuccess(data) {\n\t\tif (data.slots.unavailable_from) from.value = data.slots.unavailable_from\n\t\tif (data.slots.unavailable_to) to.value = data.slots.unavailable_to\n\t},\n})\n\nconst createSlot = createResource({\n\turl: 'frappe.client.insert',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoc: {\n\t\t\t\tdoctype: 'Evaluator Schedule',\n\t\t\t\tparent: evaluator.data?.slots.name,\n\t\t\t\tparentfield: 'schedule',\n\t\t\t\tparenttype: 'Course Evaluator',\n\t\t\t\t...newSlot,\n\t\t\t},\n\t\t}\n\t},\n\tonSuccess() {\n\t\tshowToast('Success', 'Slot added successfully', 'check')\n\t\tevaluator.reload()\n\t\tshowSlotsTemplate.value = 0\n\t\tnewSlot.day = ''\n\t\tnewSlot.start_time = ''\n\t\tnewSlot.end_time = ''\n\t},\n\tonError(err) {\n\t\tshowToast('Error', err.messages?.[0] || err, 'x')\n\t},\n})\n\nconst updateSlot = createResource({\n\turl: 'frappe.client.set_value',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoctype: 'Evaluator Schedule',\n\t\t\tname: values.name,\n\t\t\tfieldname: values.field,\n\t\t\tvalue: values.value,\n\t\t}\n\t},\n\tonSuccess() {\n\t\tshowToast('Success', 'Availability updated successfully', 'check')\n\t},\n\tonError(err) {\n\t\tshowToast('Error', err.messages?.[0] || err, 'x')\n\t},\n})\n\nconst deleteSlot = createResource({\n\turl: 'frappe.client.delete',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoctype: 'Evaluator Schedule',\n\t\t\tname: values.name,\n\t\t}\n\t},\n\tonSuccess() {\n\t\tshowToast('Success', 'Slot deleted successfully', 'check')\n\t\tevaluator.reload()\n\t},\n\tonError(err) {\n\t\tshowToast('Error', err.messages?.[0] || err, 'x')\n\t},\n})\n\nconst updateUnavailability = createResource({\n\turl: 'frappe.client.set_value',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoctype: 'Course Evaluator',\n\t\t\tname: evaluator.data?.slots.name,\n\t\t\tfieldname: values.field,\n\t\t\tvalue: values.value,\n\t\t}\n\t},\n\tonSuccess() {\n\t\tshowToast('Success', 'Unavailability updated successfully', 'check')\n\t},\n\tonError(err) {\n\t\tshowToast('Error', err.messages?.[0] || err, 'x')\n\t},\n})\n\nconst update = (name, field, value) => {\n\tupdateSlot.submit(\n\t\t{\n\t\t\tname,\n\t\t\tfield,\n\t\t\tvalue,\n\t\t},\n\t\t{\n\t\t\tvalidate() {\n\t\t\t\tif (!value) {\n\t\t\t\t\treturn `Please enter a value for ${convertToTitleCase(field)}`\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst add = () => {\n\tif (!newSlot.day || !newSlot.start_time || !newSlot.end_time) {\n\t\treturn\n\t}\n\tcreateSlot.submit()\n}\n\nconst deleteRow = (name) => {\n\tdeleteSlot.submit({ name })\n}\n\nconst authorizeCalendar = createResource({\n\turl: 'frappe.integrations.doctype.google_calendar.google_calendar.authorize_access',\n\tmakeParams() {\n\t\treturn {\n\t\t\tg_calendar: evaluator.data?.calendar,\n\t\t\treauthorize: 1,\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\twindow.open(data.url)\n\t},\n})\n\nconst days = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Monday',\n\t\t\tvalue: 'Monday',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Tuesday',\n\t\t\tvalue: 'Tuesday',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Wednesday',\n\t\t\tvalue: 'Wednesday',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Thursday',\n\t\t\tvalue: 'Thursday',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Friday',\n\t\t\tvalue: 'Friday',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Saturday',\n\t\t\tvalue: 'Saturday',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Sunday',\n\t\t\tvalue: 'Sunday',\n\t\t},\n\t]\n})\n</script>\n"],"names":["user","inject","props","__props","onMounted","_a","_b","_c","showSlotsTemplate","ref","from","to","newSlot","reactive","evaluator","createResource","data","createSlot","values","__spreadValues","showToast","err","updateSlot","deleteSlot","updateUnavailability","update","name","field","value","convertToTitleCase","add","deleteRow","authorizeCalendar","days","computed"],"mappings":"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"}