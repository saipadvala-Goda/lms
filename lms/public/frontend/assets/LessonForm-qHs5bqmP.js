var Y=Object.defineProperty;var B=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var F=(m,r,a)=>r in m?Y(m,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[r]=a,R=(m,r)=>{for(var a in r||(r={}))D.call(r,a)&&F(m,a,r[a]);if(B)for(var a of B(r))H.call(r,a)&&F(m,a,r[a]);return m};import{x as $,A as J,B as b,$ as K,a0 as G,a1 as W,I as p,P as X,C as o,r as y,w as Z,am as ee,y as T,J as f,H as i,aB as se,ac as te,N as I,a9 as P,aN as oe,K as re,d as ne,s as ae,a as le,k,az as ie,j as O,F as de,O as ue,Q as ce,av as pe,R as j}from"./frappe-ui-CfOnYHud.js";import{B as me}from"./editorjs-D5YadEn0.js";import{j as _e,P as ve,D as he,a4 as fe,a1 as U,g as be,c as ye,u as ge,b as xe}from"./index-5_0ocoxz.js";const we="/assets/lms/frontend/Youtube.mov",Ce=o("div",{class:"absolute left-0 mt-3 w-[35rem] max-w-lg -translate-x-1/2 transform rounded-lg bg-white px-4 sm:px-0 lg:max-w-3xl"},[o("div",{class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},[o("video",{controls:"",autoplay:"",muted:"",width:"100%",controlsList:"nodownload",oncontextmenu:"return false;",class:"rounded-sm"},[o("source",{src:we,type:"video/mp4"})])])],-1),Ne={__name:"YouTubeExplanation",setup(m){return(r,a)=>($(),J(p(X),{transition:"default"},{target:b(({isOpen:g,togglePopover:h})=>[K(r.$slots,"default",G(W({isOpen:g,togglePopover:h})))]),body:b(()=>[Ce]),_:3}))}},$e={class:"text-lg font-semibold"},Le={class:"mt-5 space-y-4"},Ee={class:""},ke={class:"text-xs text-gray-600 mb-1"},ze={class:"flex"},Se={class:""},qe={class:"text-xs text-gray-600 mb-1"},Te={class:"flex"},Ie={class:""},Pe={key:1,class:""},Ve={class:"flex items-center"},Be={class:"border rounded-md p-2 mr-2"},Fe={class:"flex flex-col"},Re={class:"text-xs"},Oe={class:""},je={class:"text-xs text-gray-600 mb-1"},Ue=["onClick"],Je={__name:"LessonPlugins",props:{editor:{required:!0},notesEditor:{required:!0}},setup(m){const r=y(null),a=y(null),g=y(null),h=y(null),x=y("Lesson Content"),d=m,L=l=>{w().caret.setToLastBlock("end",0),l&&(w().blocks.insert("quiz",{quiz:l}),r.value=null)},c=l=>{w().caret.setToLastBlock("end",0),w().blocks.insert("upload",l)},u=l=>{let _=l.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(_))return"Only image and video files are allowed."},z=()=>[{label:"Lesson Content",value:"Lesson Content"},{label:"Instructor Content",value:"Instructor Content"}],w=()=>x.value=="Lesson Content"?g.value:h.value;return Z(()=>[d.editor,d.notesEditor],([l,_],[E,v])=>{g.value=l,h.value=_}),(l,_)=>{const E=ee("router-link");return $(),T(re,null,[o("div",$e,f(l.__("Components")),1),o("div",Le,[i(p(te),{text:l.__("Content such as quiz, video and image will be added in the editor you select."),placement:"bottom"},{default:b(()=>[o("div",Ee,[o("div",ke,f(l.__("Select an Editor")),1),i(p(se),{modelValue:x.value,"onUpdate:modelValue":_[0]||(_[0]=v=>x.value=v),options:z()},null,8,["modelValue","options"])])]),_:1},8,["text"]),o("div",ze,[i(_e,{value:r.value,class:"flex-1",doctype:"LMS Quiz",label:l.__("Add an existing quiz"),onChange:_[1]||(_[1]=v=>L(v))},null,8,["value","label"]),i(E,{to:{name:"QuizCreation",params:{quizID:"new"}},class:"self-end ml-2"},{default:b(()=>[i(p(I),null,{icon:b(()=>[i(p(ve),{class:"h-4 w-4 stroke-1.5"})]),_:1})]),_:1})]),o("div",Se,[o("div",qe,f(l.__("Add an image, video, pdf or audio.")),1),o("div",Te,[a.value?($(),T("div",Pe,[o("div",Ve,[o("div",Be,[i(p(he),{class:"h-4 w-4 stroke-1.5 text-gray-700"})]),o("div",Fe,[o("span",Re,f(a.value.file_name),1)])])])):($(),J(p(oe),{key:0,fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:u,onSuccess:_[2]||(_[2]=v=>c(v))},{default:b(({file:v,progress:C,uploading:N,openFileSelector:S})=>[o("div",Ie,[i(p(I),{onClick:S,loading:N},{default:b(()=>[P(f(N?l.__("Uploading {0}%").format(C):l.__("Upload a File")),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])]),o("div",Oe,[o("div",je,f(l.__("To add a YouTube video, paste the URL of the video in the editor.")),1),i(Ne,null,{default:b(({togglePopover:v})=>[o("div",{onClick:C=>v(),class:"flex items-center text-sm underline cursor-pointer"},[i(p(fe),{class:"w-3 h-3 stroke-1.5 text-gray-700 mr-1"}),P(" "+f(l.__("Learn More")),1)],8,Ue)]),_:1})])])],64)}}},Me={class:""},Ae={class:"grid md:grid-cols-[75%,25%] h-screen"},Qe={class:"border-r"},Ye={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b overflow-hidden bg-white px-3 py-2.5 sm:px-5"},De={class:"py-5"},He={class:"w-5/6 mx-auto"},Ke={class:"border-t mt-4"},Ge={class:"w-5/6 mx-auto pt-4"},We={class:"block font-medium text-gray-600 mb-1"},Xe={id:"instructor-notes",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-gray-300 prose-th:border-gray-300 prose-td:relative prose-th:relative prose-th:bg-gray-100 prose-sm max-w-none !whitespace-normal py-3"},Ze={class:"border-t mt-4"},es={class:"w-5/6 mx-auto pt-4"},ss={class:"block font-medium text-gray-600 mb-1"},ts=o("div",{id:"content",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-gray-300 prose-th:border-gray-300 prose-td:relative prose-th:relative prose-th:bg-gray-100 prose-sm max-w-none !whitespace-normal py-3"},null,-1),os={class:""},rs={class:"sticky top-0 p-5"},ds={__name:"LessonForm",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(m){const r=y(null),a=y(null),g=ne("$user"),h=y(!1);let x;const d=m;ae(()=>{var e,s;!((e=g.data)!=null&&e.is_moderator)&&!((s=g.data)!=null&&s.is_instructor)&&(window.location.href="/login"),U("lesson_form_opened"),r.value=L("content"),a.value=L("instructor-notes")});const L=e=>new me({holder:e,tools:be(),autofocus:!0}),c=le({title:"",include_in_preview:!1,body:"Test",instructor_notes:"",content:""}),u=k({url:"lms.lms.utils.get_lesson_creation_details",params:{course:d.courseName,chapter:d.chapterNumber,lesson:d.lessonNumber},auto:!0,onSuccess(e){e.lesson&&(Object.keys(e.lesson).forEach(s=>{c[s]=e.lesson[s]}),c.include_in_preview=!!e.include_in_preview,z(e),w(e),l())}}),z=e=>{r.value.isReady.then(()=>{if(e.lesson.content)r.value.render(JSON.parse(e.lesson.content));else if(e.lesson.body){let s=C(e.lesson);r.value.render({blocks:s})}})},w=e=>{a.value.isReady.then(()=>{if(e.lesson.instructor_content)a.value.render(JSON.parse(e.lesson.instructor_content));else if(e.lesson.instructor_notes){let s=C(e.lesson);a.value.render({blocks:s})}})},l=()=>{x=setInterval(()=>{N()},5e3)};ie(()=>{clearInterval(x)});const _=k({url:"frappe.client.insert",makeParams(e){var s;return{doc:R({doctype:"Course Lesson",course:d.courseName,chapter:(s=u.data)==null?void 0:s.chapter.name},c)}}}),E=k({url:"frappe.client.set_value",makeParams(e){return{doctype:"Course Lesson",name:e.lesson,fieldname:c}}}),v=k({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"Lesson Reference",parent:(s=u.data)==null?void 0:s.chapter.name,parenttype:"Course Chapter",parentfield:"lessons",lesson:e.lesson,idx:d.lessonNumber}}}}),C=e=>{let s=[];if(e.youtube){let t=e.youtube.split("/").pop();s.push({type:"embed",data:{service:"youtube",embed:`https://www.youtube.com/embed/${t}`}})}return e.body.split(`
`).forEach(t=>{if(t.includes("{{ YouTubeVideo")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];n.includes("https://")||(n=`https://www.youtube.com/embed/${n}`),s.push({type:"embed",data:{service:"youtube",embed:n}})}else if(t.includes("{{ Quiz")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"quiz",data:{quiz:n}})}else if(t.includes("{{ Video")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"video"}})}else if(t.includes("{{ Audio")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"audio"}})}else if(t.includes("{{ PDF")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"pdf"}})}else if(t.includes("{{ Embed")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"embed",data:{service:n.split("|||")[0],embed:n.split("|||")[1]}})}else if(t.includes("![]")){let n=t.match(/\((.*?)\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"image"}})}else if(t.includes("#")){let n=(t.match(/#/g)||[]).length;s.push({type:"header",data:{text:t.replace(/#/g,"").trim(),level:n}})}else s.push({type:"paragraph",data:{text:t}})}),e.quizId&&s.push({type:"quiz",data:{quiz:e.quizId}}),s},N=()=>{r.value.save().then(e=>{c.content=JSON.stringify(e),a.value.save().then(s=>{var t;c.instructor_content=JSON.stringify(s),(t=u.data)!=null&&t.lesson?M():S()})})},S=()=>{_.submit({},{validate(){return V()},onSuccess(e){v.submit({lesson:e.name},{onSuccess(){U("lesson_created"),q("Success","Lesson created successfully","check"),u.reload()}})},onError(e){q("Error",e.message,"x")}})},M=()=>{E.submit({lesson:u.data.lesson.name},{validate(){return V()},onError(e){q("Error",e.message,"x")}})},V=()=>{if(!c.title)return"Title is required";if(!c.content)return"Content is required"},q=(e,s,t)=>{ye({title:e,text:s,icon:t,iconClasses:t=="check"?"bg-green-600 text-white rounded-md p-px":"bg-red-600 text-white rounded-md p-px",position:t=="check"?"bottom-right":"top-center",timeout:t=="check"?5:10})},A=O(()=>{var s,t,n;let e=[{label:"Courses",route:{name:"Courses"}},{label:(s=u.data)==null?void 0:s.course_title,route:{name:"CourseDetail",params:{courseName:d.courseName}}}];return(t=u==null?void 0:u.data)!=null&&t.lesson&&e.push({label:u.data.lesson.title,route:{name:"Lesson",params:{courseName:d.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}}),e.push({label:(n=u==null?void 0:u.data)!=null&&n.lesson?"Edit Lesson":"Create Lesson",route:{name:"LessonForm",params:{courseName:d.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}}),e}),Q=O(()=>({title:"Lesson Editor",description:"Create and edit lessons for your course"}));return ge(Q),(e,s)=>($(),T("div",Me,[o("div",Ae,[o("div",Qe,[o("header",Ye,[i(p(pe),{class:"text-ellipsis",items:A.value},null,8,["items"]),i(p(I),{variant:"solid",onClick:s[0]||(s[0]=t=>N()),class:"mt-3 md:mt-0"},{default:b(()=>[P(f(e.__("Save")),1)]),_:1})]),o("div",De,[o("div",He,[i(p(j),{modelValue:c.title,"onUpdate:modelValue":s[1]||(s[1]=t=>c.title=t),label:"Title",class:"mb-4"},null,8,["modelValue"]),i(p(j),{modelValue:c.include_in_preview,"onUpdate:modelValue":s[2]||(s[2]=t=>c.include_in_preview=t),type:"checkbox",label:"Include in Preview"},null,8,["modelValue"])]),o("div",Ke,[o("div",Ge,[o("div",{class:"flex justify-between cursor-pointer",onClick:s[3]||(s[3]=()=>{h.value=!h.value})},[o("label",We,f(e.__("Instructor Notes")),1),i(p(xe),{class:de(["stroke-2 h-5 w-5 text-gray-600",{"rotate-90 transform duration-200":h.value,"duration-200":!h.value}])},null,8,["class"])]),ue(o("div",Xe,null,512),[[ce,h.value]])])]),o("div",Ze,[o("div",es,[o("label",ss,f(e.__("Content")),1),ts])])])]),o("div",os,[o("div",rs,[i(Je,{editor:r.value,notesEditor:a.value},null,8,["editor","notesEditor"])])])])]))}};export{ds as default};
//# sourceMappingURL=LessonForm-qHs5bqmP.js.map
