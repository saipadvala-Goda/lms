var I=Object.defineProperty;var k=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var B=(u,d,m)=>d in u?I(u,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[d]=m,g=(u,d)=>{for(var m in d||(d={}))R.call(d,m)&&B(u,m,d[m]);if(k)for(var m of k(d))A.call(d,m)&&B(u,m,d[m]);return u};import{aa as H,d as J,a as K,r as q,s as X,az as G,k as f,j as Q,x as v,y as U,C as s,H as o,I as n,B as y,J as r,A as W,av as Y,a9 as x,N,R as i,aN as Z,aJ as ee}from"./frappe-ui-CfOnYHud.js";import{a1 as S,k as D,j as E,D as le,H as ae,X as te}from"./index-5_0ocoxz.js";import{_ as se}from"./MultiSelect-B-q7M6eT.js";const oe={class:""},ne={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},ie={class:"w-1/2 mx-auto py-5"},de={class:""},me={class:"text-lg font-semibold mb-4"},re={class:"grid grid-cols-2 gap-10 mb-4"},ue={class:"flex flex-col space-y-2"},ce={class:"mb-4"},be={class:"mb-4"},pe={key:1,class:"mb-4"},_e={class:"text-xs text-gray-600 mb-1"},fe={class:"flex items-center"},ge={class:"border rounded-md p-2 mr-2"},ve={class:"flex flex-col"},ye={class:"text-sm text-gray-500 mt-1"},Ve={class:"mb-4"},he={class:"block text-sm text-gray-600 mb-1"},we={class:"mb-4"},ke={class:"text-lg font-semibold mb-4"},Be={class:"grid grid-cols-2 gap-10"},Ue={class:"mb-4"},xe={class:"text-lg font-semibold mb-4"},Ne={class:"grid grid-cols-2 gap-10"},Se={class:""},De={class:"text-lg font-semibold mb-4"},$e={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(u){const d=H(),m=J("$user"),c=u,t=K({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,image:null,paid_batch:!1,currency:"",amount:0}),p=q([]);X(()=>{m.data||(window.location.href="/login"),c.batchName!="new"?_.reload():S("batch_form_opened"),window.addEventListener("keydown",V)});const V=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(h(),e.preventDefault())};G(()=>{window.removeEventListener("keydown",V)});const C=f({url:"frappe.client.insert",makeParams(e){var l;return{doc:g({doctype:"LMS Batch",meta_image:(l=t.image)==null?void 0:l.file_url,instructors:p.value.map(a=>({instructor:a}))},t)}}}),_=f({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:c.batchName}},onSuccess(e){Object.keys(e).forEach(a=>{a=="instructors"?e.instructors.forEach(b=>{p.value.push(b.instructor)}):Object.hasOwn(t,a)&&(t[a]=e[a])});let l=["published","paid_batch","allow_self_enrollment"];for(let a in l){let b=l[a];t[b]=!!t[b]}e.meta_image&&M.reload({image:e.meta_image})}}),T=f({url:"frappe.client.set_value",makeParams(e){var l;return{doctype:"LMS Batch",name:c.batchName,fieldname:g({meta_image:(l=t.image)==null?void 0:l.file_url,instructors:p.value.map(a=>({instructor:a}))},t)}}}),M=f({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),h=()=>{_.data?j():$()},$=()=>{C.submit({},{onSuccess(e){S("batch_created"),d.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var l;D("Error",((l=e.messages)==null?void 0:l[0])||e,"x")}})},j=()=>{T.submit({},{onSuccess(e){d.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var l;D("Error",((l=e.messages)==null?void 0:l[0])||e,"x")}})},z=e=>{t.image=e},L=()=>{t.image=null},O=e=>{let l=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(l))return"Only image file is allowed."},P=Q(()=>{let e=[{label:"Batches",route:{name:"Batches"}}];return _.data&&e.push({label:_.data.title,route:{name:"BatchDetail",params:{batchName:c.batchName}}}),e.push({label:c.batchName=="new"?"New Batch":"Edit Batch",route:{name:"BatchForm",params:{batchName:c.batchName}}}),e});return(e,l)=>(v(),U("div",oe,[s("header",ne,[o(n(Y),{class:"h-7",items:P.value},null,8,["items"]),o(n(N),{variant:"solid",onClick:l[0]||(l[0]=a=>h())},{default:y(()=>[x(r(e.__("Save")),1)]),_:1})]),s("div",ie,[s("div",de,[s("div",me,r(e.__("Details")),1),s("div",re,[s("div",null,[o(n(i),{modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=a=>t.title=a),label:e.__("Title"),class:"mb-4"},null,8,["modelValue","label"])]),s("div",ue,[o(n(i),{modelValue:t.published,"onUpdate:modelValue":l[2]||(l[2]=a=>t.published=a),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.allow_self_enrollment,"onUpdate:modelValue":l[3]||(l[3]=a=>t.allow_self_enrollment=a),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"])])])]),s("div",ce,[s("div",null,[t.image?(v(),U("div",pe,[s("div",_e,r(e.__("Meta Image")),1),s("div",fe,[s("div",ge,[o(n(le),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),s("div",ve,[s("span",null,r(t.image.file_name),1),s("span",ye,r(n(ae)(t.image.file_size)),1)]),o(n(te),{onClick:l[5]||(l[5]=a=>L()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(v(),W(n(Z),{key:0,class:"mt-4",fileTypes:["image/*"],validateFile:O,onSuccess:l[4]||(l[4]=a=>z(a))},{default:y(({file:a,progress:b,uploading:w,openFileSelector:F})=>[s("div",be,[o(n(N),{onClick:F,loading:w},{default:y(()=>[x(r(w?`Uploading ${b}%`:"Upload an image"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))]),o(se,{modelValue:p.value,"onUpdate:modelValue":l[6]||(l[6]=a=>p.value=a),doctype:"User",label:e.__("Instructors")},null,8,["modelValue","label"])]),s("div",Ve,[o(n(i),{modelValue:t.description,"onUpdate:modelValue":l[7]||(l[7]=a=>t.description=a),label:e.__("Description"),type:"textarea",class:"my-4"},null,8,["modelValue","label"]),s("div",null,[s("label",he,r(e.__("Batch Details")),1),o(n(ee),{content:t.batch_details,onChange:l[8]||(l[8]=a=>t.batch_details=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-gray-100 rounded-b-md py-1 px-2 min-h-[7rem] mb-4"},null,8,["content"])])]),s("div",we,[s("div",ke,r(e.__("Date and Time")),1),s("div",Be,[s("div",null,[o(n(i),{modelValue:t.start_date,"onUpdate:modelValue":l[9]||(l[9]=a=>t.start_date=a),label:e.__("Start Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_date,"onUpdate:modelValue":l[10]||(l[10]=a=>t.end_date=a),label:e.__("End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])]),s("div",null,[o(n(i),{modelValue:t.start_time,"onUpdate:modelValue":l[11]||(l[11]=a=>t.start_time=a),label:e.__("Start Time"),type:"time",class:"mb-4"},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_time,"onUpdate:modelValue":l[12]||(l[12]=a=>t.end_time=a),label:e.__("End Time"),type:"time",class:"mb-4"},null,8,["modelValue","label"]),o(n(i),{modelValue:t.timezone,"onUpdate:modelValue":l[13]||(l[13]=a=>t.timezone=a),label:e.__("Timezone"),type:"text",class:"mb-4"},null,8,["modelValue","label"])])])]),s("div",Ue,[s("div",xe,r(e.__("Settings")),1),s("div",Ne,[s("div",null,[o(n(i),{modelValue:t.seat_count,"onUpdate:modelValue":l[14]||(l[14]=a=>t.seat_count=a),label:e.__("Seat Count"),type:"number",class:"mb-4"},null,8,["modelValue","label"]),o(n(i),{modelValue:t.evaluation_end_date,"onUpdate:modelValue":l[15]||(l[15]=a=>t.evaluation_end_date=a),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])]),s("div",null,[o(n(i),{modelValue:t.medium,"onUpdate:modelValue":l[16]||(l[16]=a=>t.medium=a),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),o(E,{doctype:"LMS Category",label:e.__("Category"),modelValue:t.category,"onUpdate:modelValue":l[17]||(l[17]=a=>t.category=a)},null,8,["label","modelValue"])])])]),s("div",Se,[s("div",De,r(e.__("Payment")),1),s("div",null,[o(n(i),{modelValue:t.paid_batch,"onUpdate:modelValue":l[18]||(l[18]=a=>t.paid_batch=a),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.amount,"onUpdate:modelValue":l[19]||(l[19]=a=>t.amount=a),label:e.__("Amount"),type:"number",class:"my-4"},null,8,["modelValue","label"]),o(E,{doctype:"Currency",modelValue:t.currency,"onUpdate:modelValue":l[20]||(l[20]=a=>t.currency=a),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])])])]))}};export{$e as default};
//# sourceMappingURL=BatchForm-CM-e47BK.js.map
