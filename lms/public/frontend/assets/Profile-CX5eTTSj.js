var q=Object.defineProperty;var N=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var R=(_,m,o)=>m in _?q(_,m,{enumerable:!0,configurable:!0,writable:!0,value:o}):_[m]=o,B=(_,m)=>{for(var o in m||(m={}))H.call(m,o)&&R(_,o,m[o]);if(N)for(var o of N(m))J.call(m,o)&&R(_,o,m[o]);return _};import{d as z,am as A,x as c,y as h,C as l,a9 as $,J as f,I as e,H as d,B as p,N as C,M as V,ae as K,af as Q,a as X,k as U,w as I,A as P,aN as D,R as S,D as Y,r as F,$ as G,a0 as W,a1 as Z,aO as ee,L as ae,K as O,P as se,ay as te,aa as le,s as oe,aP as re,j as L,F as ie,b as ne,av as de,aQ as ue}from"./frappe-ui-CfOnYHud.js";import{D as me,H as ce,X as fe,k as pe,s as _e,I as ve,u as ge,J as M}from"./index-5_0ocoxz.js";import{_ as be}from"./UserAvatar-NO3477wF.js";const he={class:"border rounded-md w-1/3 mx-auto my-32"},xe={class:"border-b px-5 py-3 font-medium"},ye=l("span",{class:"inline-flex items-center before:bg-red-600 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1),ke={key:0,class:"px-5 py-3"},we={class:"px-5 py-3"},$e={__name:"NoPermission",setup(_){const m=z("$user"),o=()=>{window.location.href="/login"};return(t,x)=>{const g=A("router-link");return c(),h("div",he,[l("div",xe,[ye,$(" "+f(t.__("Not Permitted")),1)]),e(m).data?(c(),h("div",ke,[l("div",null,f(t.__("You do not have permission to access this page.")),1),d(g,{to:{name:"Courses"}},{default:p(()=>[d(e(C),{variant:"solid",class:"mt-2"},{default:p(()=>[$(f(t.__("Checkout Courses")),1)]),_:1})]),_:1})])):V("",!0),l("div",we,[l("div",null,f(t.__("Please login to access this page.")),1),d(e(C),{variant:"solid",onClick:x[0]||(x[0]=w=>o()),class:"mt-2"},{default:p(()=>[$(f(t.__("Login")),1)]),_:1})])])}}},Pe={class:"mb-4"},Ce={key:1,class:"mb-4"},Ve={class:"text-xs text-gray-600 mb-1"},Ue={class:"flex items-center"},je={class:"border rounded-md p-2 mr-2"},Se={class:"text-base flex flex-col"},Ee={class:"text-sm text-gray-500 mt-1"},Te={__name:"EditProfile",props:K({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup(_){const m=Q(_,"reloadProfile"),o=_,t=X({first_name:"",last_name:"",headline:"",bio:"",image:""}),x=U({url:"lms.lms.api.get_file_info",makeParams(a){return{file_url:a.image}},auto:!1,onSuccess(a){t.image=a}}),g=U({url:"frappe.client.set_value",makeParams(a){return{doctype:"User",name:o.profile.data.name,fieldname:B({user_image:t.image.file_url},t)}},onSuccess(a){o.profile.data=a}}),w=a=>{g.submit({},{onSuccess(){a(),m.value.reload()},onError(i){var n;pe("Error",((n=i.messages)==null?void 0:n[0])||i,"x")}})},b=a=>{let i=a.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(i))return"Only image file is allowed."},s=a=>{t.image=a},v=()=>{t.image=null};return I(()=>o.profile.data,a=>{a&&(t.first_name=a.first_name,t.last_name=a.last_name,t.headline=a.headline,t.bio=a.bio,a.user_image&&x.submit({image:a.user_image}))}),(a,i)=>(c(),P(e(Y),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:n=>w(n)}]}},{"body-content":p(()=>[l("div",null,[t.image?(c(),h("div",Ce,[l("div",Ve,f(a.__("Profile Image")),1),l("div",Ue,[l("div",je,[d(e(me),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),l("div",Se,[l("span",null,f(t.image.file_name),1),l("span",Ee,f(e(ce)(t.image.file_size)),1)]),d(e(fe),{onClick:i[1]||(i[1]=n=>v()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(c(),P(e(D),{key:0,fileTypes:["image/*"],validateFile:b,onSuccess:i[0]||(i[0]=n=>s(n))},{default:p(({file:n,progress:E,uploading:j,openFileSelector:T})=>[l("div",Pe,[d(e(C),{onClick:T,loading:j},{default:p(()=>[$(f(j?`Uploading ${E}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),d(e(S),{modelValue:t.first_name,"onUpdate:modelValue":i[2]||(i[2]=n=>t.first_name=n),label:a.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),d(e(S),{modelValue:t.last_name,"onUpdate:modelValue":i[3]||(i[3]=n=>t.last_name=n),label:a.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),d(e(S),{modelValue:t.headline,"onUpdate:modelValue":i[4]||(i[4]=n=>t.headline=n),label:a.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),d(e(S),{type:"textarea",modelValue:t.bio,"onUpdate:modelValue":i[5]||(i[5]=n=>t.bio=n),label:a.__("Bio")},null,8,["modelValue","label"])])]),_:1},8,["options"]))}},Fe={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-white px-4 sm:px-0 lg:max-w-3xl"},Ie={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Ne={class:"flex items-center justify-center space-x-2"},Re={class:""},Be={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-white lg:grid-cols-2"},Le=["onClick"],Me=["src"],ze={key:0,class:"mt-2 text-center text-sm text-gray-500"},Ae={class:"underline",target:"_blank",href:"https://unsplash.com"},De={__name:"EditCoverImage",emits:["select"],setup(_,{emit:m}){const o=F(null),t=m,x=U({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:o.value}),auto:!0,debounce:500});I(()=>o.value,()=>{x.reload()});const g=b=>{t("select",b.file_url)},w=b=>{let s=b.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(s))return"Only image file is allowed."};return(b,s)=>(c(),P(e(se),{transition:"default"},{target:p(({isOpen:v,togglePopover:a})=>[G(b.$slots,"default",W(Z({isOpen:v,togglePopover:a})))]),body:p(()=>[l("div",Fe,[l("div",Ie,[l("div",Ne,[d(e(ee),{type:"text",placeholder:"search by keyword",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=v=>o.value=v),debounce:300,class:"flex-1"},null,8,["modelValue"]),d(e(D),{fileTypes:["image/*"],validateFile:w,onSuccess:s[1]||(s[1]=v=>g(v))},{default:p(({file:v,progress:a,uploading:i,openFileSelector:n})=>[l("div",Re,[d(e(C),{onClick:n,loading:i},{default:p(()=>[$(f(i?`Uploading ${a}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),l("div",Be,[(c(!0),h(O,null,ae(e(x).data,v=>(c(),h("button",{key:v.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:a=>b.$emit("select",v.urls.raw)},[l("img",{src:v.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Me)],8,Le))),128))]),e(x).data?(c(),h("div",ze,[$(f(b.__("Image search powered by"))+" ",1),l("a",Ae,f(b.__("Unsplash")),1)])):V("",!0)])])]),_:3}))}},Oe={key:1},qe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},He={class:"group relative h-[130px] w-full"},Je=["src"],Ke={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},Qe={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Xe={class:"flex flex-col md:flex-row items-center"},Ye=["src"],Ge={class:"ml-6"},We={class:"mt-2 text-3xl font-semibold text-gray-900"},Ze={class:"mt-2 text-base text-gray-700"},ea={class:"mb-4 mt-6"},ra={__name:"Profile",props:{username:{type:String,required:!0}},setup(_){const{user:m}=_e(),o=z("$user"),t=te(),x=le(),g=F(""),w=F(!1),b=_;oe(()=>{o.data&&s.reload(),a()});const s=U({url:"frappe.client.get",makeParams(u){return{doctype:"User",filters:{username:b.username}}}}),v=U({url:"frappe.client.set_value",makeParams(u){var r;return{doctype:"User",name:(r=s.data)==null?void 0:r.name,fieldname:"cover_image",value:u.url}},onSuccess(){s.reload()}}),a=()=>{let u=t.path.split("/");["certificates","roles","evaluations"].forEach(y=>{u.includes(y)&&(g.value=ve(y))}),g.value||(g.value="About")};re(()=>{if(g.value){let u={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Evaluations:{name:"ProfileEvaluator"}}[g.value];x.push(u)}}),I(()=>b.username,()=>{s.reload()});const i=()=>{w.value=!0},n=()=>{var u,r;return((u=o.data)==null?void 0:u.email)===((r=s.data)==null?void 0:r.email)},E=()=>{var r,y;let u=[{label:"About"},{label:"Certificates"}];return(r=o.data)!=null&&r.is_moderator&&u.push({label:"Roles"}),n()&&((y=o.data)!=null&&y.is_evaluator)&&u.push({label:"Evaluations"}),u},j=L(()=>{var r,y;return[{label:"People"},{label:(r=s.data)==null?void 0:r.full_name,route:{name:"Profile",params:{username:(y=m.doc)==null?void 0:y.username}}}]}),T=L(()=>{var u,r;return{title:(u=s.data)==null?void 0:u.full_name,description:(r=s.data)==null?void 0:r.headline}});return ge(T),(u,r)=>{const y=A("router-view");return c(),h(O,null,[e(o).data?e(s).data?(c(),h("div",Oe,[l("header",qe,[d(e(de),{class:"h-7",items:j.value},null,8,["items"])]),l("div",He,[e(s).data.cover_image?(c(),h("img",{key:0,src:e(s).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,Je)):(c(),h("div",{key:1,class:ie([{"bg-gray-100":!e(s).data.cover_image},"h-[130px] w-full"])},null,2)),n()?(c(),h("div",Ke,[d(De,{onSelect:r[0]||(r[0]=k=>e(v).submit({url:k}))},{default:p(({togglePopover:k})=>[d(e(C),{variant:"outline",onClick:aa=>k()},{prefix:p(()=>[d(e(M),{class:"w-4 h-4 stroke-1.5 text-gray-700"})]),default:p(()=>[$(" "+f(u.__("Edit")),1)]),_:2},1032,["onClick"])]),_:1})])):V("",!0)]),l("div",Qe,[l("div",Xe,[l("div",null,[e(s).data.user_image?(c(),h("img",{key:0,src:e(s).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Ye)):(c(),P(be,{key:1,user:e(s).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),l("div",Ge,[l("h2",We,f(e(s).data.full_name),1),l("div",Ze,f(e(s).data.headline),1)]),n()?(c(),P(e(C),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:r[1]||(r[1]=k=>i())},{prefix:p(()=>[d(e(M),{class:"w-4 h-4 stroke-1.5 text-gray-700"})]),default:p(()=>[$(" "+f(u.__("Edit Profile")),1)]),_:1})):V("",!0)]),l("div",ea,[d(e(ue),{class:"inline-block",buttons:E(),modelValue:g.value,"onUpdate:modelValue":r[2]||(r[2]=k=>g.value=k)},null,8,["buttons","modelValue"])]),d(y,{profile:e(s)},null,8,["profile"])])])):V("",!0):(c(),P($e,{key:0})),d(Te,{modelValue:w.value,"onUpdate:modelValue":r[3]||(r[3]=k=>w.value=k),reloadProfile:e(s),"onUpdate:reloadProfile":r[4]||(r[4]=k=>ne(s)?s.value=k:null),profile:e(s)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{ra as default};
//# sourceMappingURL=Profile-CX5eTTSj.js.map
