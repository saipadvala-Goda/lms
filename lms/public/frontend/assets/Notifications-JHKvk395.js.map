{"version":3,"file":"Notifications-JHKvk395.js","sources":["../../../../frontend/src/pages/Notifications.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t<Button\n\t\t\t\t@click=\"markAllAsRead.submit\"\n\t\t\t\t:loading=\"markAllAsRead.loading\"\n\t\t\t\tv-if=\"activeTab === 'Unread' && unReadNotifications.data?.length > 0\"\n\t\t\t>\n\t\t\t\t{{ __('Mark all as read') }}\n\t\t\t</Button>\n\t\t\t<TabButtons\n\t\t\t\tclass=\"inline-block\"\n\t\t\t\t:buttons=\"[{ label: 'Unread', active: true }, { label: 'Read' }]\"\n\t\t\t\tv-model=\"activeTab\"\n\t\t\t/>\n\t\t</div>\n\t</header>\n\t<div class=\"w-3/4 mx-auto px-5 pt-6 divide-y\">\n\t\t<div\n\t\t\tv-if=\"notifications?.length\"\n\t\t\tv-for=\"log in notifications\"\n\t\t\tclass=\"flex items-center py-2 justify-between\"\n\t\t>\n\t\t\t<div class=\"flex items-center\">\n\t\t\t\t<UserAvatar :user=\"allUsers.data[log.from_user]\" class=\"mr-2\" />\n\t\t\t\t<div class=\"notification\" v-html=\"log.subject\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t<Link\n\t\t\t\t\tv-if=\"log.link\"\n\t\t\t\t\t:to=\"log.link\"\n\t\t\t\t\t@click=\"markAsRead.submit({ name: log.name })\"\n\t\t\t\t\tclass=\"text-gray-600 font-medium text-sm hover:text-gray-700\"\n\t\t\t\t>\n\t\t\t\t\t{{ __('View') }}\n\t\t\t\t</Link>\n\t\t\t\t<Tooltip :text=\"__('Mark as read')\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tv-if=\"!log.read\"\n\t\t\t\t\t\t@click=\"markAsRead.submit({ name: log.name })\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<X class=\"h-4 w-4 text-gray-700 stroke-1.5\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Button>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"text-gray-600\">\n\t\t\t{{ __('Nothing to see here.') }}\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tcreateListResource,\n\tcreateResource,\n\tBreadcrumbs,\n\tLink,\n\tTabButtons,\n\tButton,\n\tTooltip,\n} from 'frappe-ui'\nimport { computed, inject, ref, onMounted } from 'vue'\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport { useRouter } from 'vue-router'\nimport { X } from 'lucide-vue-next'\nimport { updateDocumentTitle } from '@/utils'\n\nconst user = inject('$user')\nconst socket = inject('$socket')\nconst allUsers = inject('$allUsers')\nconst activeTab = ref('Unread')\nconst router = useRouter()\n\nonMounted(() => {\n\tif (!user.data) router.push({ name: 'Courses' })\n\n\tsocket.on('publish_lms_notifications', (data) => {\n\t\tunReadNotifications.reload()\n\t})\n})\n\nconst notifications = computed(() => {\n\treturn activeTab.value === 'Unread'\n\t\t? unReadNotifications.data\n\t\t: readNotifications.data\n})\n\nconst unReadNotifications = createListResource({\n\tdoctype: 'Notification Log',\n\tfields: ['subject', 'from_user', 'link', 'read', 'name'],\n\tfilters: {\n\t\tfor_user: user.data?.name,\n\t\tread: 0,\n\t},\n\torderBy: 'creation desc',\n\tauto: true,\n\tcache: 'Unread Notifications',\n})\n\nconst readNotifications = createListResource({\n\tdoctype: 'Notification Log',\n\tfields: ['subject', 'from_user', 'link', 'read', 'name'],\n\tfilters: {\n\t\tfor_user: user.data?.name,\n\t\tread: 1,\n\t},\n\torderBy: 'creation desc',\n\tauto: true,\n\tcache: 'Read Notifications',\n})\n\nconst markAsRead = createResource({\n\turl: 'lms.lms.api.mark_as_read',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tname: values.name,\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\tunReadNotifications.reload()\n\t\treadNotifications.reload()\n\t},\n})\n\nconst markAllAsRead = createResource({\n\turl: 'lms.lms.api.mark_all_as_read',\n\tonSuccess(data) {\n\t\tunReadNotifications.reload()\n\t\treadNotifications.reload()\n\t},\n})\n\nconst breadcrumbs = computed(() => {\n\tlet crumbs = [\n\t\t{\n\t\t\tlabel: 'Notifications',\n\t\t\troute: {\n\t\t\t\tname: 'Notifications',\n\t\t\t},\n\t\t},\n\t]\n\treturn crumbs\n})\n\nconst pageMeta = computed(() => {\n\treturn {\n\t\ttitle: 'Notifications',\n\t\tdescription: 'All your notifications in one place.',\n\t}\n})\n\nupdateDocumentTitle(pageMeta)\n</script>\n<style>\n.notification strong {\n\tfont-weight: 400;\n}\n.notification b {\n\tfont-weight: 400;\n}\n</style>\n"],"names":["user","inject","socket","allUsers","activeTab","ref","router","useRouter","onMounted","data","unReadNotifications","notifications","computed","readNotifications","createListResource","_a","_b","markAsRead","createResource","values","markAllAsRead","breadcrumbs","pageMeta","updateDocumentTitle"],"mappings":"guBAyEA,MAAMA,EAAOC,EAAO,OAAO,EACrBC,EAASD,EAAO,SAAS,EACzBE,EAAWF,EAAO,WAAW,EAC7BG,EAAYC,EAAI,QAAQ,EACxBC,EAASC,EAAW,EAE1BC,EAAU,IAAM,CACVR,EAAK,MAAMM,EAAO,KAAK,CAAE,KAAM,UAAW,EAE/CJ,EAAO,GAAG,4BAA8BO,GAAS,CAChDC,EAAoB,OAAQ,CAC9B,CAAE,CACF,CAAC,EAED,MAAMC,EAAgBC,EAAS,IACvBR,EAAU,QAAU,SACxBM,EAAoB,KACpBG,EAAkB,IACrB,EAEKH,EAAsBI,EAAmB,CAC9C,QAAS,mBACT,OAAQ,CAAC,UAAW,YAAa,OAAQ,OAAQ,MAAM,EACvD,QAAS,CACR,UAAUC,EAAAf,EAAK,OAAL,YAAAe,EAAW,KACrB,KAAM,CACN,EACD,QAAS,gBACT,KAAM,GACN,MAAO,sBACR,CAAC,EAEKF,EAAoBC,EAAmB,CAC5C,QAAS,mBACT,OAAQ,CAAC,UAAW,YAAa,OAAQ,OAAQ,MAAM,EACvD,QAAS,CACR,UAAUE,EAAAhB,EAAK,OAAL,YAAAgB,EAAW,KACrB,KAAM,CACN,EACD,QAAS,gBACT,KAAM,GACN,MAAO,oBACR,CAAC,EAEKC,EAAaC,EAAe,CACjC,IAAK,2BACL,WAAWC,EAAQ,CAClB,MAAO,CACN,KAAMA,EAAO,IACb,CACD,EACD,UAAUV,EAAM,CACfC,EAAoB,OAAQ,EAC5BG,EAAkB,OAAQ,CAC1B,CACF,CAAC,EAEKO,EAAgBF,EAAe,CACpC,IAAK,+BACL,UAAUT,EAAM,CACfC,EAAoB,OAAQ,EAC5BG,EAAkB,OAAQ,CAC1B,CACF,CAAC,EAEKQ,EAAcT,EAAS,IACf,CACZ,CACC,MAAO,gBACP,MAAO,CACN,KAAM,eACN,CACD,CACD,CAED,EAEKU,EAAWV,EAAS,KAClB,CACN,MAAO,gBACP,YAAa,sCACb,EACD,EAED,OAAAW,EAAoBD,CAAQ"}